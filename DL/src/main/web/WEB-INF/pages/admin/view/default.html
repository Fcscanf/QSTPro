<html>
<head>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script src="/js/page.js"></script>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>后台首页</title></head>
<link type="text/css" rel="stylesheet" href="/css/style.css">
<body>
<center>

    <table id="searchResult" border="0" cellpadding="0" cellspacing="0" width="650" height="300">
        <thead>
        <!--<tr align="center" height="30" bgcolor="#F0F0F0">
            <td width="6%"><b>序号</b></td>
            <td width="11%"><b>信息类别</b></td>
            <td width="8%"><b>ID值</b></td>
            <td width="38%"><b>信息标题</b></td>
            <td width="22%"><b>发布时间</b></td>
            <td width="15%"><b>联系人</b></td>
        </tr>-->
        </thead>
        <tbody>
        </tbody>
    </table>
    <!--显示分页的信息-->
    <div class="row">
        <!--分页文字信息-->
        <div class="col-md-6" align="left" id="page_info_area">
        </div>
        <!--分页条信息-->
        <div class="col-md-6" align="right" id="page_nav_area">
        </div>
    </div>
</center>
</body>
<script>

    window.onload = function () {
        getUsersNotAdmin(1);
    };

    // 获取非管理员用户信息
    function getUsersNotAdmin(pN) {
        var pageSize = 5;
        $.ajax({
            url:"/user/select",
            type:"post",
            data:{
                pageNum:pN,
                pageSize:pageSize
            },
            success:function (result) {
                build_result_user(result);
                build_page_info(result);
                build_page_nav(result);
            }
        })
    }

    function build_result_user(result) {
        $("#searchResult thead").empty();
        $("#searchResult tbody").empty();
        var users = result.extend.page.list;
        console.log(users);
        var user_id = $("<td></td>").append('用户ID');
        var user_name = $("<td></td>").append('用户名');
        var option = $("<td></td>").append('操作');
        $("<tr></tr>").append(user_id)
            .append(user_name)
            .append(option)
            .appendTo("#searchResult thead");
        $.each(users, function (index, item) {
            var user_id_1 = $("<td></td>").append(item.id);
            var user_name_1 = $("<td></td>").append(item.userName);
            var editBtn = $("<button></button>").addClass("btn btn-success btn-sm edit_btn")
                .append($("<span></span>").addClass("glyphicon glyphicon-pencil").append("Edit"));
            //为编辑按钮添加一个自定义的属性，来表示当前用户id
            editBtn.attr("edit-id", item.id);
            var delBtn = $("<button></button>").addClass("btn btn-danger btn-sm delete_btn")
                .append($("<span></span>").addClass("glyphicon glyphicon-trash").append("Delete"));
            delBtn.attr("del-id", item.id);
            var btnTd = $("<td></td>").append(editBtn).append(" | ").append(delBtn);
            $("<tr></tr>").append(user_id_1)
                .append(user_name_1)
                .append(btnTd)
                .appendTo("#searchResult tbody");
        });
    }

    function getInfo(pN) {
        var pay = window.localStorage.getItem("m_pay");
        var check = window.localStorage.getItem("m_check");
        var type = window.localStorage.getItem("m_type");
        var pageSize = 5;
        $.ajax({
            url:"/info/select",
            type:"post",
            data:{
                pageNum:pN,
                pageSize:pageSize,
                infoPayfor:pay,
                infoCheck:check,
                infoType:type
            },
            success:function (result) {
                build_result(result);
                build_page_info(result);
                build_page_nav(result);
            }
        })
    }

    // 解析并显示结果集
    function build_result(result) {
        $("#searchResult thead").empty();
        $("#searchResult tbody").empty();
        var infos = result.extend.page.list;
        console.log(infos);
        var id_1 = $("<td></td>").append('序号');
        var infoType_1 = $("<td></td>").append('信息类别');
        var infoId_1 = $("<td></td>").append('ID值');
        var infoTitle_1 = $("<td></td>").append('信息标题');
        var infoDate_1 = $("<td></td>").append('发布时间');
        var infoLinkman_1 = $("<td></td>").append('联系人');
        $("<tr></tr>").append(id_1)
            .append(infoType_1)
            .append(infoId_1)
            .append(infoTitle_1)
            .append(infoDate_1)
            .append(infoLinkman_1)
            .appendTo("#searchResult thead");
        $.each(infos, function (index, item) {
            var id = $("<td></td>").append(index + 1);
            var infoType = $("<td></td>").append(item.type.typeName);
            var infoId = $("<td></td>").append(item.id);
            var infoTitle = $("<td></td>").append(item.infoTitle);
            var infoDate = $("<td></td>").append(item.infoDate);
            var infoLinkman = $("<td></td>").append(item.infoLinkman);
            $("<tr></tr>").append(id)
                .append(infoType)
                .append(infoId)
                .append(infoTitle)
                .append(infoDate)
                .append(infoLinkman)
                .appendTo("#searchResult tbody");
        });
    }
</script>
</html>